# CAP Theorem
<img width="693" alt="스크린샷 2023-05-08 오후 6 49 22" src="https://user-images.githubusercontent.com/60481383/236793185-45c8bc4c-0f95-422f-bff1-cf122f36a566.png">

> MySQL의 경우, Cap Theorem 에서 CA에는 해당이 되지만, Partition tolerance(분할 허용성)을 보장하지 않습니다. 이게 무슨 의미이며, 그 이유는 무엇인가요?
- MySQL은 데이터의 일관성과 가용성을 보장하지만, Partition tolerance(분할 허용성)을 보장하지 않는다 라는 의미이다.
- MySQL은 주로 단일 서버에 데이터를 저장하고 관리하는 중앙 집중식 데이터베이스 시스템이다.
- 따라서 네트워크 분할이 발생하면, 분할된 네트워크 영역에 있는 클라이언트와 해당 데이터베이스 서버 간의 통신이 중단된다.
- 이때, MySQL은 일관성을 유지하기 위해 분할된 네트워크 영역에 있는 클라이언트와의 통신을 중단하고 데이터 일관성을 유지한다.
- 이로 인해 분할된 영역에 있는 클라이언트는 해당 데이터베이스에 접근할 수 없게 된다.
- 따라서, Partition tolerance를 보장하지 않습니다.

> Redis의 경우, Cap Theorem 에서 CP에는 해당이 되지만, Availability을 보장하지 않는다. 이게 무슨 의미이며, 그 이유는 무엇인가요?
- Redis는 데이터 일관성과 분할 허용성을 보장하는 특징을 가지고 있지만, Availability(가용성)을 보장하지 않는다는 의미이다.

- Redis는 모든 상황에서 완전한 가용성(Availability)을 보장하지는 않습니다. 
- 네트워크 분할이 발생하면 분할된 영역에 있는 클라이언트에게 가용성 문제가 발생할 수 있습니다.



## Cap Theorem 이란 무엇인가요?
- 분산 시스템에서 일관성(Consistency), 가용성(Availability), 분할 용이(Partition tolerance)이라는 3가지 조건을 모두 만족할 수 없다는 정리이다.
- 3가지 중 2가지를 택하라는 것으로 많이 알려졌다.
- 분산 시스템을 설계할 때는 이 3 가지 속성 중에서 어떤 속성을 우선시할 것인지 선택해야 한다.

### 일관성(Consistency)
> 분산된 서버에서 데이터가 얼마나 Consistent 하게 존재할 수 있느냐

- 일관성은 여러 사용자 또는 클라이언트가 동시에 서버에 접근하고 데이터를 읽거나 쓸 때, `데이터가 일관된 상태로 sync가 맞는 것`을 말한다.
- 음식점에서 메뉴를 주문하는 애플리케이션 상황에서 생각해보면,
- "일관성이 있다"라고 했을 때에는 주문자가 주문을 했을 때, 주문자 어플, 판매자 어플 모두 주문이 모두 대기표 1번으로 접수된 상태를 말한다.
- 반면, "일관성이 깨졌다"라고 했을 때에는 주문자 어플에서는 대기표 1번으로 주문이 접수된 걸로 나오지만, 판매자 어플에서는 대기표 2번으로 주문이 접수된 상태를 말한다.
- 즉, 데이터의 추가 또는 변경이 발생하면 모든 관련된 데이터는 동시에 생성 또는 업데이트되어 일관된 상태를 유지해야 합니다

### 가용성(Availability)
> 우리 서버에 사용자가 항상 이용할 수 있느냐

- 가용성은 서버가 중단 없이 `계속 이용 가능한 상태`를 유지하는 것을 말합니다.
- 따라서, 가용성이 높은 서버는 사용자들이 필요할 때 언제든지 서비스에 접근할 수 있도록 보장한다.

### 분할 용이(Partition tolerance)
> 분산 환경에서 우리 서버들이 파티션 되었을 때, 어떤 네트워크 장애로 인해서 서버들끼리 서로 커뮤니테이션할 수 없는 상황이 발생할 경우에 어떻게 대처할 것인가
 
- 시스템 내의 네트워크 연결이 실패하거나 지연되는 경우에도 시스템이 계속 동작해야 한다. 
- 즉, 시스템은 네트워크 분할이 발생하더라도 작동하고 데이터 일관성을 유지해야 한다.

- 만약, 어떤 네트워크 장애가 일어나서 이 두 ATM이 서로 대화할 수 없게 되었다고 가정해보자.
- 이러한 상황을 CAP Theorem에서는 "Partition이 일어났다"라고 이야기한다.
- 이런 파티션이 일어나게 되면 서로 다른 ATM 간의 데이터 Consistency를 맞출 수 없게 된다.
- 이런 경우에 우리는 2가지 중 하나를 선택할 수 밖에 없다.
  1) Availability : 우리 서비스를 그럼에도 불구하고 이용하게 할 것인가?
  2) Consistency : 서비스를 잠시 중단을 하더라도, 데이터가 Inconsistent 해지는 상황만은 막자.
- 만약, 1번을 선택했다고 했을 때(= 100% Availability 하자)의 문제점은 데이터 일관성이 깨질 수 있다는 것이다.
- 예를 들어, 사용자가 A ATM에 가서 돈을 입금하고 예금 잔고를 확인했다. 그런데, B ATM 가서 예금 잔고를 확인하게 되면, A ATM에 입금 금액이 반영이 안되어 있어서 사용자 입장에서는 당황스러울 것 같다.
- 반면, 만약, 2번을 선택했다고 했을 때(= 100% Consistency 하자)의 문제점은 고객이 서비스를 아예 이용 불가능할 수 있는 상황이 발생할 수 있다는 것이다.
- 예를 들어, 고객이 A ATM에 가서 돈을 입금하거나 출금하거나 예금 잔고를 확인하려고 했을 때, A ATM은 지금 고장났어 이용 못해! 하는 문제점이 발생한다.

### cf. Reliability(신뢰성)
- 서버의 신뢰성은 시스템이 `예상하는 대로` 정확하게 동작하여, 주어진 기능을 올바르게 수행하고, 장애나 오류가 발생할 가능성을 최소화하여 중단 없이 동작할 수 있는 능력을 말한다. 

### cf. Integrity(무결성)
- 무결성은 데이터의 정확성과 무결성을 보장하는 것을 의미한다.
- 음식점에서 메뉴를 주문하는 애플리케이션 상황에서 생각해보면,
- "무결성이 깨졌다"라는 의미는 주문자가 주문을 했을 때에는 대기표를 받았는데, 그 번호가 -999 등으로 유효한 대기번호가 아닌 경우를 말한다.
- 상식적으로 대기표 번호는 음수 값이 아닌 양수 값으로 표현되어야 하기 때문이다.

# Reference
- https://www.nexsoftsys.com/articles/CAP-theorem-database-dbms.html
- http://eincs.com/2013/07/misleading-and-truth-of-cap-theorem/
- https://blog.seulgi.kim/2018/03/cap-theorem.html
- https://www.youtube.com/watch?v=DdfN9Hh3Km4&ab_channel=CODERXDOX%EC%BD%94%EB%8D%94%EC%97%91%EC%8A%A4%EB%8F%85%EC%8A%A4